import{j as r}from"./jsx-runtime.TBa3i5EZ.js";import{r as d}from"./index.CVf8TyFT.js";function X({posts:x}){const S=d.useRef(null),O=d.useRef(null),[y,E]=d.useState(null),[i,F]=d.useState(()=>new Date().getFullYear()),[p,Y]=d.useState("dark"),M={light:{0:"#ebedf0",1:"#9be9a8",2:"#40c463",3:"#30a14e",4:"#216e39",text:"#24292f",subtext:"#57606a"},dark:{0:"#161B22",1:"#0e4429",2:"#006d32",3:"#26a641",4:"#39d353",text:"#adbac7",subtext:"#768390"}};d.useEffect(()=>{const t=localStorage.getItem("theme")==="dark";Y(t?"dark":"light");const n=A();n.length>0&&F(n[0])},[]),d.useEffect(()=>{const e=()=>{const l=localStorage.getItem("theme")==="dark";Y(l?"dark":"light")},t=()=>{e()},n=new MutationObserver(s=>{s.forEach(l=>{l.attributeName==="class"&&e()})});return window.addEventListener("themeChange",t),n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>{n.disconnect(),window.removeEventListener("themeChange",t)}},[]);const A=()=>{const e=new Set;return x.forEach(t=>{const n=new Date(t.data.pubDatetime).getFullYear();e.add(n)}),Array.from(e).sort((t,n)=>n-t)},L=e=>{const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["January","February","March","April","May","June","July","August","September","October","November","December"];return`${t[e.getDay()]}, ${n[e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`},$=()=>{if(!S.current)return;const e=S.current,t=e.getContext("2d");if(!t)return;const n=window.devicePixelRatio||1,s=10*n,l=2*n,b=53,g=7,v=28*n,m=28*n,D=m+b*(s+l),w=v+g*(s+l);e.style.width=`${D/n}px`,e.style.height=`${w/n}px`,e.width=D,e.height=w,t.scale(n,n),t.clearRect(0,0,e.width,e.height);const u=new Map;x.forEach(a=>{const c=new Date(a.data.pubDatetime);if(c.getFullYear()===i){const o=c.toISOString().split("T")[0];u.set(o,(u.get(o)||0)+1)}});const k=(new Date(i,0,1).getDay()+6)%7,C=["Mon","Wed","Fri"];t.textAlign="right",t.fillStyle=M[p].subtext,t.font="bold 11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",C.forEach((a,c)=>{const o=v/n+c*2*((s+l)/n)+s/n;t.fillText(a,(m-4)/n,o)}),t.textAlign="left",t.fillStyle=M[p].text,t.font="bold 11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace";const T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=new Date(i,0,1),j=new Date(i,11,31);T.forEach((a,c)=>{const o=new Date(i,c,1),f=Math.floor((o.getTime()-h.getTime())/(7*24*60*60*1e3));if(f>=0&&f<b){const R=(m+f*(s+l))/n;t.fillText(a,R,14)}});for(let a=0;a<b;a++)for(let c=0;c<g;c++){const o=new Date(h);if(o.setDate(o.getDate()-k+a*7+c),o>=h&&o<=j){const f=o.toISOString().split("T")[0],R=u.get(f)||0,P=Math.min(R,4),J=(m+a*(s+l))/n,z=(v+c*(s+l))/n,I=s/n,H=2;t.beginPath(),t.roundRect(J,z,I,I,H),t.fillStyle=M[p][P],t.fill()}}};return d.useEffect(()=>{$()},[x,i,p]),d.useEffect(()=>{const e=S.current,t=O.current;if(!e||!t)return;const n=10,s=2,l=28,b=28,g=new Date(i,0,1),v=new Date(i,11,31),m=(g.getDay()+6)%7,D=u=>{const N=e.getBoundingClientRect(),k=t.getBoundingClientRect(),C=u.clientX-N.left-b,T=u.clientY-N.top-l,h=Math.floor(C/(n+s)),j=Math.floor(T/(n+s));if(h>=0&&j>=0){const a=new Date(g);if(a.setDate(a.getDate()-m+h*7+j),a>=g&&a<=v){const c=a.toISOString().split("T")[0],o=x.filter(f=>new Date(f.data.pubDatetime).toISOString().split("T")[0]===c).length;E({x:u.clientX-k.left,y:u.clientY-k.top,date:L(a),count:o});return}}E(null)},w=()=>{E(null)};return e.addEventListener("mousemove",D),e.addEventListener("mouseleave",w),()=>{e.removeEventListener("mousemove",D),e.removeEventListener("mouseleave",w)}},[i,x]),r.jsxs("div",{className:"my-8",children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-medium",children:[i," Publication Activity"]}),r.jsx("select",{value:i,onChange:e=>F(Number(e.target.value)),className:"rounded-md border bg-transparent px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200 dark:focus:ring-offset-gray-800",children:A().map(e=>r.jsx("option",{value:e,className:"dark:bg-gray-800",children:e},e))})]}),r.jsxs("div",{className:"relative",ref:O,children:[r.jsx("canvas",{ref:S,width:900,height:140,className:"w-full"}),r.jsxs("div",{className:"mt-4 flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[r.jsx("span",{children:"Less"}),Object.values(M[p]).slice(0,5).map((e,t)=>r.jsx("div",{className:"h-3 w-3 rounded-sm",style:{backgroundColor:e}},t)),r.jsx("span",{children:"More"})]}),y&&r.jsxs("div",{className:"pointer-events-none absolute z-10 -translate-y-full transform rounded-lg bg-gray-800 px-3 py-2 text-xs text-white shadow-lg dark:bg-gray-700",style:{left:`${y.x}px`,top:`${y.y-10}px`},children:[r.jsxs("div",{className:"font-medium",children:[y.count," posts"]}),r.jsx("div",{className:"text-gray-300",children:y.date})]})]})]})}export{X as default};
